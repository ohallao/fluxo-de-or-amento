# -*- coding: utf-8 -*-
"""Untitled22.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1CWLaZ1m2KZL8gRubGkJ55bOgmEo4-e5V
"""

import streamlit as st
import pandas as pd
import matplotlib.pyplot as plt

# Título do App
st.title('Budget Flow - Projeção Mensal e Anual')

# Seções do App
st.header('Insira seus Dados')

# Função para capturar os dados do usuário via Streamlit
def inserir_dados_streamlit():
    categorias = {}

    # Receitas
    st.subheader('Receitas')
    categorias["Receitas"] = {}
    n_receitas = st.number_input("Quantas fontes de receita você tem?", min_value=1, step=1)
    for i in range(n_receitas):
        fonte = st.text_input(f"Digite o nome da receita {i + 1}", key=f"receita_{i}")
        valor = st.number_input(f"Digite o valor mensal da receita {i + 1}: R$", min_value=0.0, step=100.0, key=f"valor_receita_{i}")
        categorias["Receitas"][fonte] = valor

    # Despesas Fixas
    st.subheader('Despesas Fixas')
    categorias["Despesas Fixas"] = {}
    n_despesas_fixas = st.number_input("Quantas despesas fixas você tem?", min_value=1, step=1)
    for i in range(n_despesas_fixas):
        despesa = st.text_input(f"Digite o nome da despesa fixa {i + 1}", key=f"despesa_fixa_{i}")
        valor = st.number_input(f"Digite o valor mensal da despesa fixa {i + 1}: R$", min_value=0.0, step=50.0, key=f"valor_despesa_fixa_{i}")
        categorias["Despesas Fixas"][despesa] = valor

    # Despesas Variáveis
    st.subheader('Despesas Variáveis')
    categorias["Despesas Variáveis"] = {}
    n_despesas_variaveis = st.number_input("Quantas despesas variáveis você tem?", min_value=1, step=1)
    for i in range(n_despesas_variaveis):
        despesa = st.text_input(f"Digite o nome da despesa variável {i + 1}", key=f"despesa_variavel_{i}")
        valor = st.number_input(f"Digite o valor mensal da despesa variável {i + 1}: R$", min_value=0.0, step=50.0, key=f"valor_despesa_variavel_{i}")
        categorias["Despesas Variáveis"][despesa] = valor

    # Impostos
    st.subheader('Impostos')
    categorias["Impostos"] = {}
    n_impostos = st.number_input("Quantos impostos você paga?", min_value=1, step=1)
    for i in range(n_impostos):
        imposto = st.text_input(f"Digite o nome do imposto {i + 1}", key=f"imposto_{i}")
        valor = st.number_input(f"Digite o valor mensal do imposto {i + 1}: R$", min_value=0.0, step=50.0, key=f"valor_imposto_{i}")
        categorias["Impostos"][imposto] = valor

    # Investimentos
    st.subheader('Investimentos')
    categorias["Investimentos"] = {}
    n_investimentos = st.number_input("Quantos investimentos você faz?", min_value=1, step=1)
    for i in range(n_investimentos):
        investimento = st.text_input(f"Digite o nome do investimento {i + 1}", key=f"investimento_{i}")
        valor = st.number_input(f"Digite o valor mensal do investimento {i + 1}: R$", min_value=0.0, step=50.0, key=f"valor_investimento_{i}")
        categorias["Investimentos"][investimento] = valor

    return categorias

# Função para calcular o total de cada categoria
def calcular_total(categoria, is_anual=False):
    total = sum(categorias[categoria].values())
    if is_anual:
        total *= 12
    return total

# Captura os dados do usuário
categorias = inserir_dados_streamlit()

# Calcular os totais por categoria
totais_mensais = {cat: calcular_total(cat) for cat in categorias}
totais_anuais = {cat: calcular_total(cat, is_anual=True) for cat in categorias}

# Calcular o fluxo de caixa
fluxo_caixa_mensal = totais_mensais["Receitas"] - sum(totais_mensais[cat] for cat in categorias if cat != "Receitas")
fluxo_caixa_anual = totais_anuais["Receitas"] - sum(totais_anuais[cat] for cat in categorias if cat != "Receitas")

# Personalização do Dashboard
st.header('Personalizar Dashboard')
graficos_selecionados = st.multiselect(
    "Escolha os gráficos que deseja ver:",
    ['Resumo Mensal', 'Resumo Anual', 'Gráfico de Despesas Mensais', 'Gráfico de Despesas Anuais']
)

# Exibir resultados de acordo com a seleção
if 'Resumo Mensal' in graficos_selecionados:
    st.subheader('Resumo Mensal')
    st.write(f"Receitas Mensais: R$ {totais_mensais['Receitas']}")
    st.write(f"Fluxo de Caixa Mensal: R$ {fluxo_caixa_mensal}")

if 'Resumo Anual' in graficos_selecionados:
    st.subheader('Resumo Anual')
    st.write(f"Receitas Anuais: R$ {totais_anuais['Receitas']}")
    st.write(f"Fluxo de Caixa Anual: R$ {fluxo_caixa_anual}")

if 'Gráfico de Despesas Mensais' in graficos_selecionados:
    st.subheader('Gráfico de Despesas Mensais')
    fig, ax = plt.subplots()
    ax.bar(categorias.keys(), totais_mensais.values(), color="lightcoral")
    ax.set_ylabel("Valor em R$")
    st.pyplot(fig)

if 'Gráfico de Despesas Anuais' in graficos_selecionados:
    st.subheader('Gráfico de Despesas Anuais')
    fig, ax = plt.subplots()
    ax.bar(categorias.keys(), totais_anuais.values(), color="skyblue")
    ax.set_ylabel("Valor em R$")
    st.pyplot(fig)